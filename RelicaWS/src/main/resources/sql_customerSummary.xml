<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
<comment>This  xml includes utility related queries.</comment>

<entry key="assetDetailsByJCID.sql">
SELECT 
A.ID A_ID, A.NAME AS NAME, DAM_INTERNAL_ID, REPOSITORY, A.FS_PATH AS FS_PATH, FILESIZE, POLICY_ID, 
ASSET_MD5, USER_MD5, CREATED_DATE, DELETE_DATE, L_PATH, C.ID AS CUSTOMER_ID, C.NAME AS CUSTOMER_NAME, 
AI.ID AI_ID, STORAGE_LOCATION_ID, FILENAME, LOCATION_MD5, CREATE_DATE, 
LAST_CHECK, PURGE_DATE, STATUS, ENCRYPTED, SL.PATH AS BASE_PATH, SL.SIGNIANT_ID AS SIGNIANT_ID
FROM 
ASSET_REPLICA.DBO.ASSETS A WITH(NOLOCK), 
ASSET_REPLICA.DBO.ASSET_INSTANCES AI WITH(NOLOCK),
ASSET_REPLICA.DBO.POLICIES P,
ASSET_REPLICA.DBO.CUSTOMERS C,
ASSET_REPLICA.DBO.STORAGE_LOCATIONS SL
WHERE 
A.ID=AI.ASSET_ID AND
A.POLICY_ID=P.ID AND
P.CUSTOMER_ID=C.ID AND
AI.STORAGE_LOCATION_ID=SL.ID AND 
(AI.STATUS='N' OR AI.STATUS='V') AND
A.ID=:assetId
</entry>

<entry key="assetDetailsByDAMID.sql">

SELECT 
A.ID A_ID, A.NAME AS NAME, DAM_INTERNAL_ID, REPOSITORY, A.FS_PATH AS FS_PATH, FILESIZE, POLICY_ID, 
ASSET_MD5, USER_MD5, CREATED_DATE, DELETE_DATE, L_PATH, C.ID AS CUSTOMER_ID, C.NAME AS CUSTOMER_NAME, 
AI.ID AI_ID, STORAGE_LOCATION_ID, FILENAME, LOCATION_MD5, CREATE_DATE, 
LAST_CHECK, PURGE_DATE, STATUS, ENCRYPTED, SL.PATH AS BASE_PATH, SL.SIGNIANT_ID AS SIGNIANT_ID
FROM 
ASSET_REPLICA.DBO.ASSETS A WITH(NOLOCK), 
ASSET_REPLICA.DBO.ASSET_INSTANCES AI WITH(NOLOCK),
ASSET_REPLICA.DBO.POLICIES P,
ASSET_REPLICA.DBO.CUSTOMERS C,
ASSET_REPLICA.DBO.STORAGE_LOCATIONS SL
WHERE 
A.ID=AI.ASSET_ID AND
A.POLICY_ID=P.ID AND
P.CUSTOMER_ID=C.ID AND
AI.STORAGE_LOCATION_ID=SL.ID AND 
(AI.STATUS='N' OR AI.STATUS='V') AND
A.DAM_INTERNAL_ID=:dam_internal_id AND
A.REPOSITORY=:repository
</entry>

<entry key="totalAssetsAndTotalSize.sql">
SELECT COUNT(A.ID) TOTALASSETS, SUM(A.FILESIZE) SIZEINBYTES 
FROM ASSET_REPLICA.DBO.ASSETS A WITH(NOLOCK), ASSET_REPLICA.DBO.POLICIES P, ASSET_REPLICA.DBO.CUSTOMERS C 
WHERE 
A.DELETE_DATE IS NULL AND
A.POLICY_ID = P.ID AND 
P.CUSTOMER_ID = C.ID AND
C.ID = :customerId
</entry>

<entry key="allStorageNames.sql">
SELECT NAME FROM ASSET_REPLICA.DBO.STORAGE_LOCATIONS
</entry>

<entry key="customerUsageBeforeReportStartDate.sql">
DECLARE 
@STARTDATE DATETIME , 
@CUSTOMERID INTEGER
      
SET @STARTDATE=:startDate
SET @CUSTOMERID=:customerId

SELECT  SL.NAME NAME, SUM(A.FILESIZE) SIZEINBYTES 
FROM  
ASSET_REPLICA.DBO.ASSET_INSTANCES AI WITH(NOLOCK),
ASSET_REPLICA.DBO.ASSETS A WITH(NOLOCK), 
ASSET_REPLICA.DBO.POLICIES P,  
ASSET_REPLICA.DBO.CUSTOMERS C, 
ASSET_REPLICA.DBO.STORAGE_LOCATIONS SL
WHERE 
A.ID=AI.ASSET_ID AND
A.POLICY_ID=P.ID AND
C.ID=P.CUSTOMER_ID AND
SL.ID=AI.STORAGE_LOCATION_ID AND
AI.status &lt;> 'I' AND
C.ID = @CUSTOMERID AND
DATEADD(dd, 0, DATEDIFF(dd, 0, AI.CREATE_DATE)) &lt;= DATEADD(dd, -1, DATEDIFF(dd, 0, @STARTDATE)) AND
( AI.PURGE_DATE IS NULL OR DATEADD(dd, 0, DATEDIFF(dd, 0, AI.PURGE_DATE)) > DATEADD(dd, -1, DATEDIFF(dd, 0, @STARTDATE)) ) 
GROUP BY SL.NAME
</entry>

<entry key="customerUsageInReportDateRange.sql">
DECLARE 
@STARTDATE DATETIME , 
@ENDDATE DATETIME ,
@CUSTOMERID INTEGER
      
SET @STARTDATE=:startDate
SET @ENDDATE=:endDate
SET @CUSTOMERID=:customerId

SELECT  DATEADD(dd, 0, DATEDIFF(dd, 0, AI.CREATE_DATE)) REPORTDATE, 
SL.NAME STORAGENAME, SUM(A.FILESIZE) SIZEINBYTES ,'ADDED' FLAG
FROM  
ASSET_REPLICA.DBO.ASSET_INSTANCES AI WITH(NOLOCK),
ASSET_REPLICA.DBO.ASSETS A WITH(NOLOCK), 
ASSET_REPLICA.DBO.POLICIES P,  
ASSET_REPLICA.DBO.CUSTOMERS C, 
ASSET_REPLICA.DBO.STORAGE_LOCATIONS SL
WHERE 
A.ID=AI.ASSET_ID AND
A.POLICY_ID=P.ID AND
C.ID=P.CUSTOMER_ID AND
SL.ID=AI.STORAGE_LOCATION_ID AND
AI.status &lt;> 'I' AND
C.ID = @CUSTOMERID AND
DATEADD(dd, 0, DATEDIFF(dd, 0, AI.CREATE_DATE)) 
BETWEEN DATEADD(dd, 0, DATEDIFF(dd, 0, @STARTDATE)) AND DATEADD(dd, 0, DATEDIFF(dd, 0, @ENDDATE))
GROUP BY DATEADD(dd, 0, DATEDIFF(dd, 0, AI.CREATE_DATE)), SL.NAME

UNION ALL

SELECT DATEADD(dd, 0, DATEDIFF(dd, 0, AI.PURGE_DATE)) REPORTDATE, 
SL.NAME STORAGENAME, SUM(A.FILESIZE) SIZEINBYTES ,'DELETED' FLAG
FROM  
ASSET_REPLICA.DBO.ASSET_INSTANCES AI WITH(NOLOCK),
ASSET_REPLICA.DBO.ASSETS A WITH(NOLOCK), 
ASSET_REPLICA.DBO.POLICIES P,  
ASSET_REPLICA.DBO.CUSTOMERS C, 
ASSET_REPLICA.DBO.STORAGE_LOCATIONS SL
WHERE 
A.ID=AI.ASSET_ID AND
A.POLICY_ID=P.ID AND
C.ID=P.CUSTOMER_ID AND
SL.ID=AI.STORAGE_LOCATION_ID AND
AI.status &lt;> 'I'  AND
C.ID = @CUSTOMERID AND
DATEADD(dd, 0, DATEDIFF(dd, 0, AI.PURGE_DATE)) 
BETWEEN DATEADD(dd, 0, DATEDIFF(dd, 0, @STARTDATE)) AND DATEADD(dd, 0, DATEDIFF(dd, 0, @ENDDATE))
GROUP BY DATEADD(dd, 0, DATEDIFF(dd, 0, AI.PURGE_DATE)), SL.NAME
ORDER BY REPORTDATE, FLAG
</entry>	

</properties>
